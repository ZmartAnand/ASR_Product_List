<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title>ASR-Works</ion-title>
    <ion-button slot="end" size="small" (click)="goToNext()" color="primary" [disabled]="!listSelectedProducts.length">
      Next
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <ion-row class="align-items-center">
    <ion-col size="11">
      <ion-searchbar show-clear-button="always" placeholder="Search products..." (ionInput)="onSearchChange($event)"
        mode="ios">
      </ion-searchbar>
    </ion-col>
    <ion-col size="1" class="d-flex justify-content-center">
      <ion-button fill="clear" class="mt-10" (click)="presentViewOptions()">
        <ion-icon class="fs-25 " name="funnel-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-col>
  </ion-row>


  @if(listOpen) {
  @for(category of uniqueCategories; track category) {
  <ion-item-divider>
    <label class="ion-text-capitalize"> {{ category }}</label>
  </ion-item-divider>

  <ion-list class="br-10" inset="true">
    <ng-container *ngFor="let product of getProductsByCategory(category)">
      <ion-item color="light">
        <ion-label class="ion-text-capitalize">
          {{ product.productName }}
        </ion-label>

        <ion-select slot="end" interface="popover" placeholder="Choose Size" multiple="true"
          *ngIf="product?.fileSize?.length" [(ngModel)]="product.selectedSizes" (ionChange)="onSizeChange(product)">
          <ion-select-option *ngFor="let size of product.fileSize" [value]="size">
            {{ size }}
          </ion-select-option>
        </ion-select>

        <ion-checkbox class="ion-margin-start" [checked]="isChecked(product)" (ionChange)="onChange($event, product)"
          slot="end" [disabled]="product?.fileSize?.length && !product?.selectedSizes?.length"></ion-checkbox>
      </ion-item>
    </ng-container>
  </ion-list>

  }
  }

  @if(accordionOpen) {
  <ion-accordion-group multiple="true">
    @for(category of uniqueCategories; track category) {
    <ion-accordion>
      <ion-item slot="header" color="light">
        <ion-label>{{ category }}</ion-label>
      </ion-item>
      @for(product of getProductsByCategory(category); track product) {
      <div class="p-10" slot="content">
        {{ product.productName }}
        @if(product?.fileSize?.length) {
        @for(size of product.fileSize; track $index) {
        <ion-chip class="ms-5">{{ size }}</ion-chip>
        }
        }
      </div>
      }
    </ion-accordion>
    }
  </ion-accordion-group>
  }


</ion-content>